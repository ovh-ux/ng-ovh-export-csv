/*! ovh-angular-export-csv - 0.3.1 - 2017-08-22 */
angular.module("ovh-angular-export-csv",[]),angular.module("ovh-angular-export-csv").directive("exportCsv",["$q","$parse","exportCsv",function(a,b,c){"use strict";return{scope:{exportCsv:"&",name:"@exportCsvFileName",separator:"@exportCsvSeparator"},replace:!1,compile:function(){var d=b("exportToCSV();");return function(b,e){b.exportToCSV=function(){a.when(b.exportCsv()).then(function(a){a&&c.exportData({fileName:b.name,separator:b.separator,datas:a})})},e.bind("click",function(){d(b)})}}}}]),angular.module("ovh-angular-export-csv").service("exportCsv",["$location",function(a){"use strict";function b(a){var b;if(!a.instanceName)throw new Error("[wroughtDataForCsv()]: missing options");b=a.instanceName.toString(),f[b]||(f[b]={}),f[b].data=a.internalData}function c(a,b,c){if(!a.instanceName)throw new Error("missing instanceName");if(!g[b])throw new Error("invalide status");f[a.instanceName.toString()].status=g[b],"error"===b&&(f[a.instanceName.toString()].error=c||null)}function d(a,b){a.notify&&a.notify(a.internalData),c(a,"error",b),a.error&&a.error(b,a.internalData)}var e=this,f={},g={notFound:"NOT_FOUND",doing:"DOING",error:"ERROR"};this.exportData=function(b){var c,d,e,f="",g=[],h=b.separator||",";return b.fileName?d=b.fileName:(d=a.path().replace(/\//,""),d=d.replace(/\//g,"-"),a.search().TAB&&(d+=a.search().TAB)),d+="-"+moment().format("YYYY-MM-DD_HH:mm:ss")+".csv","string"==typeof b.datas?f=b.datas:"[object Array]"===Object.prototype.toString.call(b.datas)?(angular.forEach(b.datas,function(a){g.push(a.join(h))}),f+=g.join("\n")):f+=b.datas.join("\n"),e=navigator.platform.toUpperCase().indexOf("WIN")>-1?"data:text/csv;charset=windows-1252;base64,"+btoa(unescape(encodeURIComponent(f))):"data:text/csv;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(f))),c=document.createElement("a"),void 0!==c.download?(c.setAttribute("href",e),c.setAttribute("download",d),c.setAttribute("style","visibility:hidden"),document.body.appendChild(c),c.click(),document.body.removeChild(c)):window.open(e),e},this.wroughtDataForCsv=function(a,h){if(!(a&&a.instanceName&&a.iterator&&a.keepGoing))throw new Error("[wroughtDataForCsv()]: missing options");h||e.getExportCsvStatus!==g.doing||d(a,new Error("the process "+a.instanceName+" is already in progress")),b(a),c(a,"doing"),a.iterator(a.internalData).then(function(){a.notify&&a.notify(a.internalData),a.keepGoing(a.internalData).then(function(b){b?e.wroughtDataForCsv(a,!0):(a.done&&a.done(a.internalData),delete f[a.instanceName.toString()])},function(b){d(a,b)})},function(b){d(a,b)})},this.getExportCsvStatus=function(a){if(!a)throw new Error("[getExportCsvStatus()]: missing instance name");return f[a]?f[a].status:g.notFound},this.getExportCsvError=function(a){if(!a)throw new Error("[getExportCsvError()]: missing instance name");return f[a]&&f[a].error?f[a].error:null},Object.defineProperty(e,"statusEnum",{enumerable:!0,configurable:!1,get:function(){return angular.copy(g)},set:function(){throw new Error("'statusEnum' is a read only property")}})}]);